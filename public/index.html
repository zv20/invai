<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Grocery Inventory</title>
    
    <!-- Core CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/v0.6.0-features.css">
    <link rel="stylesheet" href="css/filters.css">
    <link rel="stylesheet" href="css/categories.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Mobile Optimizations -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="InvAI">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="msapplication-navbutton-color" content="#1a1a2e">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-167x167.png">
    
    <!-- Mobile CSS -->
    <link rel="stylesheet" href="/css/mobile.css">
    
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <!-- v0.8.1: Authentication Check - MUST load first -->
    <script src="/js/auth.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 20px;">
                <button class="menu-toggle" title="Menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <h1>ğŸ›ï¸ Grocery Inventory</h1>
            </div>
            <div class="header-right">
                <button id="darkModeToggle" class="icon-btn" title="Toggle theme">ğŸŒ™</button>
                <div id="status" class="status">Connecting...</div>
                <div class="current-time" id="currentTime"></div>
                <button data-action="logout" class="icon-btn" title="Logout" style="margin-left: 10px;">ğŸšº</button>
            </div>
        </div>

        <div id="updateBanner" class="update-banner" style="display: none;">
            ğŸ‰ New version available! <button data-action="viewGitHubUpdate" style="margin-left:10px;padding:5px 15px;">View Update</button>
        </div>

        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Menu</h3>
                <button class="close-sidebar">âœ•</button>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" data-tab="dashboard">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-tab="inventory">
                    <span class="nav-icon">ğŸ“¦</span>
                    <span class="nav-text">Inventory</span>
                </a>
                <a href="#" class="nav-item" data-tab="reports">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">Reports</span>
                </a>
                <a href="#" class="nav-item" data-tab="settings">
                    <span class="nav-icon">âš™ï¸</span>
                    <span class="nav-text">Settings</span>
                </a>
            </nav>
        </div>

        <!-- Overlay for mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Dashboard Tab -->
        <div id="dashboardTab" class="tab-content active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="margin: 0;">ğŸ“Š Dashboard</h2>
                <button class="refresh-button" data-action="refreshDashboard">ğŸ”„ Refresh</button>
            </div>

            <!-- Stats Cards -->
            <div class="dashboard-grid">
                <div class="stat-card stat-card-primary">
                    <div class="stat-icon">ğŸ“¦</div>
                    <div class="stat-label">Total Products</div>
                    <div class="stat-value" id="dash-total-products">0</div>
                </div>
                <div class="stat-card stat-card-success">
                    <div class="stat-icon">ğŸ“‹</div>
                    <div class="stat-label">Total Items</div>
                    <div class="stat-value" id="dash-total-items">0</div>
                </div>
                <div class="stat-card stat-card-warning">
                    <div class="stat-icon">ğŸ’°</div>
                    <div class="stat-label">Total Value</div>
                    <div class="stat-value" id="dash-total-value">$0.00</div>
                </div>
                <div class="stat-card stat-card-danger">
                    <div class="stat-icon">âš ï¸</div>
                    <div class="stat-label">Low Stock Items</div>
                    <div class="stat-value" id="dash-low-stock">0</div>
                </div>
            </div>

            <!-- Expiration Alerts -->
            <div class="dashboard-section">
                <h3>ğŸš¨ Expiration Alerts</h3>
                <div class="alerts-container">
                    <div class="alert-box alert-box-expired">
                        <div class="alert-header">
                            <div class="alert-title">âŒ Expired</div>
                            <div class="alert-count" id="alert-expired-count">0</div>
                        </div>
                        <div class="alert-list" id="expiredList">
                            <div class="empty-state-small">âœ“ All good!</div>
                        </div>
                    </div>
                    <div class="alert-box alert-box-urgent">
                        <div class="alert-header">
                            <div class="alert-title">âš ï¸ Urgent (7 days)</div>
                            <div class="alert-count" id="alert-urgent-count">0</div>
                        </div>
                        <div class="alert-list" id="urgentList">
                            <div class="empty-state-small">âœ“ All good!</div>
                        </div>
                    </div>
                    <div class="alert-box alert-box-soon">
                        <div class="alert-header">
                            <div class="alert-title">â° Soon (30 days)</div>
                            <div class="alert-count" id="alert-soon-count">0</div>
                        </div>
                        <div class="alert-list" id="soonList">
                            <div class="empty-state-small">âœ“ All good!</div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div class="dashboard-section">
                    <h3>ğŸ“ Category Breakdown</h3>
                    <div class="category-breakdown" id="categoryBreakdown">
                        <div class="empty-state-small">No categories yet</div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>â±ï¸ Recent Products</h3>
                    <div class="activity-list" id="recentActivity">
                        <div class="empty-state-small">No recent products</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Unified Inventory Tab -->
        <div id="inventoryTab" class="tab-content">
            <!-- Product List View -->
            <div id="inventoryListView">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <h2 style="margin: 0;">ğŸ“¦ Inventory</h2>
                    <button data-action="openAddProductModal">â• Add Product</button>
                </div>

                <div id="inventoryValueSummary" class="value-summary" style="display: none;">
                    <div class="value-card">
                        <div class="value-label">Total Products</div>
                        <div class="value-amount" id="totalProducts">0</div>
                    </div>
                    <div class="value-card">
                        <div class="value-label">Total Items</div>
                        <div class="value-amount" id="totalItems">0</div>
                    </div>
                    <div class="value-card value-highlight">
                        <div class="value-label">ğŸ’° Total Inventory Value</div>
                        <div class="value-amount" id="totalValue">$0.00</div>
                    </div>
                </div>

                <div class="search-bar-container">
                    <input type="text" id="productSearch" placeholder="ğŸ” Search products...">
                    <button class="btn-scan" data-action="openScanner" data-param="search">ğŸ“· Scan Barcode</button>
                </div>

                <!-- Filters Panel (v0.7.4) -->
                <div id="filtersPanel" class="filters-panel">
                    <div class="filters-header">
                        <h4>ğŸ›ï¸ Filters <span id="activeFilterCount" class="filter-count">0</span></h4>
                        <button class="clear-filters-btn" data-action="clearAllFilters" style="display: none;">âœ• Clear All</button>
                    </div>
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label>Category</label>
                            <select id="filterCategory">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Supplier</label>
                            <select id="filterSupplier">
                                <option value="">All Suppliers</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Stock Status</label>
                            <select id="filterStock">
                                <option value="">All Stock Levels</option>
                                <option value="in-stock">In Stock</option>
                                <option value="low-stock">Low Stock</option>
                                <option value="out-of-stock">Out of Stock</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Expiry Status</label>
                            <select id="filterExpiry">
                                <option value="">All Expiry Status</option>
                                <option value="expired">Expired</option>
                                <option value="urgent">Urgent (7 days)</option>
                                <option value="soon">Soon (30 days)</option>
                                <option value="normal">Normal</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="productList" class="product-list">
                    <div class="empty-state">
                        <h3>No products yet</h3>
                        <p>Add your first product to get started</p>
                    </div>
                </div>
            </div>

            <!-- Product Detail View -->
            <div id="inventoryDetailView" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <button data-action="backToInventoryList" style="background: #6b7280;">â† Back to Inventory</button>
                </div>

                <!-- Expiration Alert Banners -->
                <div id="detailAlertBanners"></div>

                <!-- Batch Suggestion (v0.6.0) -->
                <div id="batch-suggestion-container" class="batch-suggestion-container"></div>

                <!-- Product Info Card -->
                <div class="dashboard-section" style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <h2 style="margin: 0; margin-bottom: 10px;" id="detailProductName">Product Name</h2>
                            <div id="detailProductMeta" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button data-action="editProductFromDetail">âœï¸ Edit Product</button>
                            <button data-action="deleteProductFromDetail" class="btn-danger">ğŸ—‘ï¸ Delete</button>
                        </div>
                    </div>
                    <div id="detailProductInfo" style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;"></div>
                </div>

                <!-- Inventory Batches -->
                <div class="dashboard-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0;">ğŸ“‹ Inventory Batches</h3>
                        <button data-action="openAddBatchModal">â• Add Batch</button>
                    </div>
                    <div id="detailBatchList" class="batch-list"></div>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reportsTab" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">ğŸ“Š Reports & Analytics</h2>
                <button id="exportReportBtn">ğŸ’¾ Export Report</button>
            </div>

            <div class="report-nav">
                <button class="report-nav-item active" data-report="overview">Overview</button>
                <button class="report-nav-item" data-report="stock-value">Stock Value</button>
                <button class="report-nav-item" data-report="expiration">Expiration</button>
                <button class="report-nav-item" data-report="low-stock">Low Stock</button>
                <button class="report-nav-item" data-report="turnover">Turnover</button>
            </div>

            <div id="reportContent" class="report-content">
                <div class="loading">Loading reports...</div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content">
            <h2 style="margin-bottom: 20px;">âš™ï¸ Settings</h2>
            <div class="settings-nav">
                <button class="settings-nav-item active" data-settings-tab="updates">ğŸ”„ Updates</button>
                <button class="settings-nav-item" data-settings-tab="categories">ğŸ·ï¸ Categories</button>
                <button class="settings-nav-item" data-settings-tab="suppliers">ğŸ“¦ Suppliers</button>
                <button class="settings-nav-item" data-settings-tab="backups">ğŸ’¾ Backups</button>
                <button class="settings-nav-item" data-settings-tab="about">â„¹ï¸ About</button>
                <button class="settings-nav-item" data-settings-tab="danger">âš ï¸ Danger Zone</button>
            </div>

            <!-- Updates Tab -->
            <div id="settings-updates" class="settings-subtab active">
                <div class="settings-section">
                    <h3>ğŸ”„ Update Channel</h3>
                    <div id="channelSelector"></div>
                    <div id="currentStatus"></div>
                    <div class="btn-group">
                        <button id="checkUpdatesBtn" data-action="checkForUpdatesNow">ğŸ” Check for Updates</button>
                        <button id="switchChannelBtn" data-action="switchChannelAndUpdate" disabled>ğŸ”„ Switch Channel & Update</button>
                    </div>
                    <div id="versionStatus" style="display: none; margin-top: 15px; padding: 15px; border-radius: 8px;"></div>
                </div>
                <div class="settings-section">
                    <h3>â„¹ï¸ System Information</h3>
                    <p><strong>Running Version:</strong> <span id="settingsVersion">Checking...</span></p>
                    <p style="margin-top: 10px;"><strong>Latest Version:</strong> <span id="latestVersion">Checking...</span></p>
                    <p style="margin-top: 10px;"><strong>Database:</strong> SQLite</p>
                    <p style="margin-top: 10px;"><strong>Last Check:</strong> <span id="lastCheck">Never</span></p>
                </div>
            </div>

            <!-- Categories Tab (v0.7.4) -->
            <div id="settings-categories" class="settings-subtab">
                <div class="settings-section">
                    <h3>ğŸ·ï¸ Categories Management</h3>
                    <p style="margin-bottom: 15px;">Organize your products into categories for better filtering and reporting.</p>
                    <button data-action="openAddCategoryModal">â• Add Category</button>
                    <div id="categoriesList" class="categories-list" style="margin-top: 20px;">
                        <div class="loading">Loading categories...</div>
                    </div>
                </div>
            </div>

            <!-- Suppliers Tab (v0.7.4) -->
            <div id="settings-suppliers" class="settings-subtab">
                <div class="settings-section">
                    <h3>ğŸ“¦ Suppliers Management</h3>
                    <p style="margin-bottom: 15px;">Manage your supplier contacts and track products by supplier.</p>
                    <button data-action="openAddSupplierModal">â• Add Supplier</button>
                    <div id="suppliersList" class="suppliers-list" style="margin-top: 20px;">
                        <div class="loading">Loading suppliers...</div>
                    </div>
                </div>
            </div>

            <!-- Backups Tab -->
            <div id="settings-backups" class="settings-subtab">
                <div class="settings-section">
                    <h3>ğŸ’¾ Database Backups</h3>
                    <p style="margin-bottom: 15px;">Create and manage database backups. System automatically keeps the last 10 backups.</p>
                    <div class="btn-group">
                        <button data-action="createBackup">ğŸ’¾ Create Backup Now</button>
                        <button class="btn-import" data-action="triggerUploadRestore">ğŸ“¤ Upload & Restore</button>
                    </div>
                    <input type="file" id="backupUploadInput" accept=".db" style="display: none;">
                    <div class="help-text" style="margin-top: 10px;">Create new backups or upload an existing backup file to restore</div>
                    <h4 style="margin-top: 25px; margin-bottom: 15px;">Backup History</h4>
                    <div id="backupList" class="backup-list">
                        <div style="text-align: center; padding: 20px; color: #9ca3af;">ğŸ“‚ Loading backups...</div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>ğŸ“Š Data Management</h3>
                    <div class="btn-group">
                        <button class="btn-export" data-action="exportCSV">ğŸ’¾ Export to CSV</button>
                        <button class="btn-import" data-action="triggerImport">ğŸ“‚ Import from CSV</button>
                    </div>
                    <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                    <div class="help-text" style="margin-top: 10px;">Export your inventory data or import from a backup CSV file</div>
                </div>
            </div>

            <!-- About Tab -->
            <div id="settings-about" class="settings-subtab">
                <div class="settings-section">
                    <h3>ğŸ›ï¸ Grocery Inventory v0.8.1</h3>
                    <p style="margin-top: 10px;">Professional inventory management for grocery stores</p>
                    <h4 style="margin-top: 25px; margin-bottom: 10px;">Latest Changes</h4>
                    <ul class="changelog-list">
                        <li>ğŸ” <strong>v0.8.1</strong> - Authentication & Authorization, User Management, Login System</li>
                        <li>ğŸ¨ <strong>v0.8.0</strong> - Dark Mode, Keyboard Shortcuts, Command Palette, Reports & Activity Log</li>
                        <li>ğŸ·ï¸ <strong>v0.7.4</strong> - Categories & Suppliers Foundation with Filtering</li>
                        <li>ğŸ”§ <strong>v0.7.0</strong> - Migration System & Update Channels</li>
                        <li>ğŸ’¡ <strong>v0.6.0</strong> - Smart Inventory Actions (FIFO/FEFO, Quick Actions, Notifications)</li>
                        <li>ğŸ”„ <strong>v0.4.0</strong> - Unified Inventory with click-through detail view</li>
                        <li>ğŸ“Š <strong>v0.3.0</strong> - Dashboard with statistics and expiration alerts</li>
                    </ul>
                    <h4 style="margin-top: 25px; margin-bottom: 10px;">Features</h4>
                    <ul class="changelog-list">
                        <li>ğŸ” JWT-based authentication & authorization</li>
                        <li>ğŸ‘¥ User management with role-based access</li>
                        <li>ğŸ“Š Dashboard with real-time statistics</li>
                        <li>ğŸŒ™ Dark mode with system preference detection</li>
                        <li>âŒ¨ï¸ Keyboard shortcuts for power users</li>
                        <li>ğŸ¯ Command palette for quick actions</li>
                        <li>ğŸ“Š Reports and analytics</li>
                        <li>ğŸ“ Activity log tracking</li>
                        <li>â­ Favorites system</li>
                        <li>ğŸ·ï¸ Categories & Suppliers management</li>
                        <li>ğŸ›ï¸ Advanced filtering system</li>
                        <li>ğŸš¨ Expiration alerts (expired, urgent, soon)</li>
                        <li>ğŸ’¡ Smart batch suggestions (FIFO/FEFO)</li>
                        <li>âš¡ Quick actions for batch adjustments</li>
                        <li>ğŸ“¦ Product catalog management</li>
                        <li>ğŸ“‹ Batch inventory tracking</li>
                        <li>ğŸ“· Barcode scanning</li>
                        <li>ğŸ’¾ Automated backups with retention</li>
                        <li>ğŸ“Š CSV import/export</li>
                    </ul>
                    <h4 style="margin-top: 25px; margin-bottom: 10px;">Links</h4>
                    <p><a href="https://github.com/zv20/invai" target="_blank" style="color: #667eea; text-decoration: underline;">ğŸ”— GitHub Repository</a></p>
                    <p style="margin-top: 10px;"><a href="https://github.com/zv20/invai/blob/beta/CHANGELOG.md" target="_blank" style="color: #667eea; text-decoration: underline;">ğŸ“‹ Full Changelog</a></p>
                    <p style="margin-top: 10px;"><a href="https://github.com/zv20/invai/issues" target="_blank" style="color: #667eea; text-decoration: underline;">ğŸ“ Report an Issue</a></p>
                    <h4 style="margin-top: 25px; margin-bottom: 10px;">License</h4>
                    <p>MIT License - Free to use and modify</p>
                </div>
            </div>

            <!-- Danger Zone Tab -->
            <div id="settings-danger" class="settings-subtab">
                <div class="settings-section">
                    <h3>âš ï¸ Danger Zone</h3>
                    <p style="margin-bottom: 15px; color: #dc2626;"><strong>Warning:</strong> Actions in this section are permanent and cannot be undone. Please create a backup before proceeding.</p>
                    <button class="btn-danger" data-action="confirmReset">ğŸ—‘ï¸ Reset All Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Command Palette (NEW v0.8.0) -->
    <div id="commandPalette" class="command-palette">
        <div class="command-palette-content">
            <input type="text" id="commandInput" placeholder="Type a command..." autocomplete="off">
            <div id="commandResults" class="command-results"></div>
        </div>
    </div>

    <div id="versionFooter" class="version-footer" title="Click to check for updates">
        <span id="footerVersionText">v0.8.1</span>
    </div>

    <!-- Scanner Modal -->
    <div id="scannerModal" class="modal">
        <div class="modal-content scanner-content">
            <div class="modal-header">
                <h2>ğŸ“· Barcode Scanner</h2>
                <button class="close-modal" data-action="closeScanner">âœ• Close</button>
            </div>
            <div id="reader"></div>
            <div class="scanner-info">
                <strong>ğŸ’¡ Tips:</strong>
                <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li>Allow camera access when prompted</li>
                    <li>Hold barcode steady in camera view</li>
                    <li>Works with UPC, EAN, QR codes</li>
                </ul>
            </div>
            <div id="scannerResult" class="scanner-result">
                <strong>âœ“ Scanned:</strong> <span id="scannedCode"></span>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="productModalTitle">Add Product</h2>
                <button class="close-modal" data-action="closeProductModal">âœ• Close</button>
            </div>
            <form id="productForm">
                <div class="form-row">
                    <div>
                        <label>Product Name *</label>
                        <input type="text" id="prodName" required placeholder="e.g., Coca Cola 2L">
                    </div>
                    <div>
                        <label>Brand</label>
                        <input type="text" id="prodBrand" placeholder="e.g., Coca-Cola">
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>Supplier</label>
                        <select id="prodSupplier">
                            <option value="">Select supplier...</option>
                        </select>
                    </div>
                    <div>
                        <label>Category</label>
                        <select id="prodCategory">
                            <option value="">Select category...</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>Barcode / UPC</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="prodBarcode" placeholder="Scan or enter" style="flex: 1;">
                            <button type="button" class="btn-scan-inline" data-action="openScanner" data-param="product-form" title="Scan barcode">
                                ğŸ“·
                            </button>
                        </div>
                    </div>
                    <div>
                        <label>In-House Number</label>
                        <input type="text" id="prodInhouse" placeholder="Internal SKU">
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>Items Per Case *</label>
                        <input type="number" id="prodPerCase" required min="1" placeholder="e.g., 12">
                        <div class="help-text">How many items in each case</div>
                    </div>
                    <div>
                        <label>Cost Per Case</label>
                        <input type="number" id="prodCostPerCase" step="0.01" min="0" placeholder="e.g., 24.00">
                        <div class="help-text" id="costPerItemDisplay">Cost per item: $0.00</div>
                    </div>
                </div>
                <div class="form-row">
                    <div style="grid-column: 1 / -1;">
                        <label>Notes</label>
                        <textarea id="prodNotes" rows="2" placeholder="Product notes..."></textarea>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" style="flex: 1;">Save Product</button>
                    <button type="button" data-action="closeProductModal" style="background: #6b7280; flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Batch Modal -->
    <div id="batchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="batchModalTitle">Add Inventory Batch</h2>
                <button class="close-modal" data-action="closeBatchModal">âœ• Close</button>
            </div>
            <form id="batchForm">
                <div class="form-row">
                    <div>
                        <label>Number of Cases *</label>
                        <input type="number" id="batchCases" required min="1" placeholder="e.g., 5">
                    </div>
                    <div>
                        <label>Total Items</label>
                        <input type="number" id="batchTotal" readonly style="background: #f3f4f6;">
                        <div class="help-text" id="batchCalc">Auto-calculated</div>
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>Expiration Date</label>
                        <input type="date" id="batchExpiry">
                    </div>
                    <div>
                        <label>Location</label>
                        <input type="text" id="batchLocation" placeholder="e.g., Aisle 3">
                    </div>
                </div>
                <div class="form-row">
                    <div style="grid-column: 1 / -1;">
                        <label>Batch Notes</label>
                        <textarea id="batchNotes" rows="2" placeholder="Delivery notes..."></textarea>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" style="flex: 1;">Save Batch</button>
                    <button type="button" data-action="closeBatchModal" style="background: #6b7280; flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Category Modal (v0.7.4) -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="categoryModalTitle">Add Category</h2>
                <button class="close-modal" data-action="closeCategoryModal">âœ• Close</button>
            </div>
            <form id="categoryForm">
                <div class="form-row">
                    <div>
                        <label>Category Name *</label>
                        <input type="text" id="categoryName" required placeholder="e.g., Beverages">
                    </div>
                    <div>
                        <label>Color</label>
                        <input type="color" id="categoryColor" value="#667eea">
                    </div>
                </div>
                <div class="form-row">
                    <div style="grid-column: 1 / -1;">
                        <label>Description</label>
                        <textarea id="categoryDescription" rows="2" placeholder="Category description..."></textarea>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" style="flex: 1;">Save Category</button>
                    <button type="button" data-action="closeCategoryModal" style="background: #6b7280; flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supplier Modal (v0.7.4) -->
    <div id="supplierModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="supplierModalTitle">Add Supplier</h2>
                <button class="close-modal" data-action="closeSupplierModal">âœ• Close</button>
            </div>
            <form id="supplierForm">
                <div class="form-row">
                    <div style="grid-column: 1 / -1;">
                        <label>Supplier Name *</label>
                        <input type="text" id="supplierName" required placeholder="e.g., Sysco Foods">
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>Contact Name</label>
                        <input type="text" id="supplierContactName" placeholder="e.g., John Smith">
                    </div>
                    <div>
                        <label>Contact Phone</label>
                        <input type="tel" id="supplierContactPhone" placeholder="e.g., (555) 123-4567">
                    </div>
                </div>
                <div class="form-row">
                    <div style="grid-column: 1 / -1;">
                        <label>Contact Email</label>
                        <input type="email" id="supplierContactEmail" placeholder="e.g., sales@sysco.com">
                    </div>
                </div>
                <div class="form-row">
                    <div style="grid-column: 1 / -1;">
                        <label>Address</label>
                        <textarea id="supplierAddress" rows="2" placeholder="Supplier address..."></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div style="grid-column: 1 / -1;">
                        <label>Notes</label>
                        <textarea id="supplierNotes" rows="2" placeholder="Supplier notes..."></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div style="grid-column: 1 / -1;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="supplierIsActive" checked style="width: auto;">
                            <span>Active (uncheck to mark as inactive)</span>
                        </label>
                        <div class="help-text">Inactive suppliers won't appear in product dropdowns</div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" style="flex: 1;">Save Supplier</button>
                    <button type="button" data-action="closeSupplierModal" style="background: #6b7280; flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Load JavaScript modules in CORRECT ORDER -->
    <!-- CRITICAL: Event handlers MUST load BEFORE other modules -->
    <script src="js/utils.js"></script>
    
    <!-- CSP-compliant event handler system (MUST load early) -->
    <script src="js/event-handlers.js"></script>
    
    <!-- v0.8.0 modules - Load these BEFORE core.js -->
    <script src="js/dark-mode.js"></script>
    <script src="js/activity-log.js"></script>
    <script src="js/favorites.js"></script>
    <script src="js/keyboard-shortcuts.js"></script>
    <script src="js/command-palette.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/charts.js"></script>
    
    <!-- Core initialization - AFTER v0.8.0 modules -->
    <script src="js/core.js"></script>
    
    <!-- Feature modules -->
    <script src="js/dashboard.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/scanner.js"></script>
    <script src="js/batch-suggestions.js"></script>
    <script src="js/quick-actions.js"></script>
    <script src="js/update-settings.js"></script>
    <script src="js/filters.js"></script>
    <script src="js/categories-manager.js"></script>
    <script src="js/suppliers-manager.js"></script>
    
    <!-- PWA Scripts -->
    <script src="/lib/pwa/offlineStorage.js"></script>
    <script src="/js/pwa-init.js"></script>
    <script src="/js/pwa-install.js"></script>
    
    <!-- Mobile Scripts -->
    <script src="/js/touch-gestures.js"></script>
    <script src="/js/mobile-components.js"></script>
    <script src="/js/mobile-navigation.js"></script>
    
    <!-- Mobile Features -->
    <script src="/js/barcode-scanner.js"></script>
    <script src="/js/camera-capture.js"></script>
</body>
</html>
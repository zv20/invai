<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Inventory</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 20px;">
                <button class="menu-toggle" onclick="toggleMenu()" title="Menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <h1>üõí Grocery Inventory</h1>
            </div>
            <div class="header-right">
                <div id="status" class="status">Connecting...</div>
                <div class="current-time" id="currentTime"></div>
            </div>
        </div>

        <div id="updateBanner" class="update-banner">
            üéâ New version available! <button onclick="window.open('https://github.com/zv20/invai', '_blank')" style="margin-left:10px;padding:5px 15px;">View Update</button>
        </div>

        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Menu</h3>
                <button class="close-sidebar" onclick="toggleMenu()">‚úï</button>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" onclick="switchTab('products')">
                    <span class="nav-icon">üì¶</span>
                    <span class="nav-text">Products</span>
                </a>
                <a href="#" class="nav-item" onclick="switchTab('inventory')">
                    <span class="nav-icon">üìã</span>
                    <span class="nav-text">Inventory</span>
                </a>
                <a href="#" class="nav-item" onclick="switchTab('settings')">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-text">Settings</span>
                </a>
            </nav>
        </div>

        <!-- Overlay for mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleMenu()"></div>

        <!-- Products Tab -->
        <div id="productsTab" class="tab-content active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>Product Catalog</h2>
                <button onclick="openAddProductModal()">‚ûï Add Product</button>
            </div>

            <div class="search-bar-container">
                <input type="text" id="productSearch" placeholder="üîç Search products...">
                <button class="btn-scan" onclick="openScanner('search')">üì∑ Scan Barcode</button>
            </div>

            <div id="productList" class="product-list">
                <div class="empty-state">
                    <h3>No products yet</h3>
                    <p>Add your first product to get started</p>
                </div>
            </div>
        </div>

        <!-- Inventory Tab -->
        <div id="inventoryTab" class="tab-content">
            <h2 style="margin-bottom: 20px;">Stock Management</h2>

            <div style="margin-bottom: 20px;">
                <label>Select Product</label>
                <div style="display: flex; gap: 10px;">
                    <select id="inventoryProductSelect" style="flex: 1;" onchange="loadBatches()">
                        <option value="">-- Choose a product --</option>
                    </select>
                    <button class="btn-scan" onclick="openScanner('search')">üì∑ Scan</button>
                </div>
            </div>

            <div id="batchSection" class="batch-section" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0;">Inventory Batches</h3>
                    <button onclick="openAddBatchModal()">‚ûï Add Batch</button>
                </div>

                <div id="batchList" class="batch-list"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content">
            <h2 style="margin-bottom: 20px;">Settings</h2>

            <div class="settings-section">
                <h3>üìä Data Management</h3>
                <div class="btn-group">
                    <button class="btn-export" onclick="exportCSV()">üíæ Export to CSV</button>
                    <button class="btn-import" onclick="triggerImport()">üìÇ Import from CSV</button>
                </div>
                <input type="file" id="csvFileInput" accept=".csv" onchange="handleImport(event)">
                <div class="help-text" style="margin-top: 10px;">Export your inventory data or import from a backup CSV file</div>
            </div>

            <div class="settings-section">
                <h3>‚ÑπÔ∏è System Information</h3>
                <p><strong>Running Version:</strong> <span id="settingsVersion">Checking...</span></p>
                <p style="margin-top: 10px;"><strong>Latest Version:</strong> <span id="latestVersion">Checking...</span></p>
                <p style="margin-top: 10px;"><strong>Database:</strong> SQLite</p>
                <p style="margin-top: 10px;"><strong>Last Check:</strong> <span id="lastCheck">Never</span></p>
                
                <div style="margin-top: 20px;">
                    <label>Auto-Update Check Frequency</label>
                    <select id="updateCheckInterval" onchange="saveUpdateInterval()" style="width: 100%; max-width: 300px; margin-top: 5px;">
                        <option value="0">Never (Manual only)</option>
                        <option value="3600000">Every Hour</option>
                        <option value="21600000">Every 6 Hours</option>
                        <option value="43200000">Every 12 Hours</option>
                        <option value="86400000" selected>Every 24 Hours (Default)</option>
                        <option value="604800000">Weekly</option>
                    </select>
                    <div class="help-text" style="margin-top: 5px;">Choose how often to automatically check for updates in the background</div>
                </div>

                <button onclick="checkVersion()" style="margin-top: 15px;">üîÑ Check for Updates Now</button>
                <div id="versionStatus" style="margin-top: 15px; padding: 10px; border-radius: 8px; display: none;"></div>
            </div>

            <div class="settings-section">
                <h3>‚ö†Ô∏è Danger Zone</h3>
                <p style="margin-bottom: 15px;">Backup your data before performing these actions</p>
                <button class="btn-danger" onclick="confirmReset()">üóëÔ∏è Reset All Data</button>
            </div>
        </div>
    </div>

    <div id="versionFooter" class="version-footer" onclick="checkVersion()" title="Click to check for updates">
        <span id="footerVersionText">Checking...</span>
    </div>

    <!-- Scanner Modal -->
    <div id="scannerModal" class="modal">
        <div class="modal-content scanner-content">
            <div class="modal-header">
                <h2>üì∑ Barcode Scanner</h2>
                <button class="close-modal" onclick="closeScanner()">‚úï Close</button>
            </div>
            <div id="reader"></div>
            <div class="scanner-info">
                <strong>üí° Tips:</strong>
                <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li>Allow camera access when prompted</li>
                    <li>Hold barcode steady in camera view</li>
                    <li>Works with UPC, EAN, QR codes</li>
                </ul>
            </div>
            <div id="scannerResult" class="scanner-result">
                <strong>‚úì Scanned:</strong> <span id="scannedCode"></span>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="productModalTitle">Add Product</h2>
                <button class="close-modal" onclick="closeProductModal()">‚úï Close</button>
            </div>
            <form id="productForm">
                <div class="form-row">
                    <div>
                        <label>Product Name *</label>
                        <input type="text" id="prodName" required placeholder="e.g., Coca Cola 2L">
                    </div>
                    <div>
                        <label>Brand</label>
                        <input type="text" id="prodBrand" placeholder="e.g., Coca-Cola">
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>Supplier</label>
                        <input type="text" id="prodSupplier" list="supplierList" placeholder="e.g., Sysco">
                        <datalist id="supplierList"></datalist>
                    </div>
                    <div>
                        <label>Category</label>
                        <input type="text" id="prodCategory" placeholder="e.g., Beverages">
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>Barcode / UPC</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="prodBarcode" placeholder="Scan or enter" style="flex: 1;">
                            <button type="button" class="btn-scan-inline" onclick="openScanner('product-form')" title="Scan barcode">
                                üì∑
                            </button>
                        </div>
                    </div>
                    <div>
                        <label>In-House Number</label>
                        <input type="text" id="prodInhouse" placeholder="Internal SKU">
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>Items Per Case *</label>
                        <input type="number" id="prodPerCase" required min="1" placeholder="e.g., 12">
                        <div class="help-text">How many items in each case</div>
                    </div>
                </div>
                <div class="form-row">
                    <div style="grid-column: 1 / -1;">
                        <label>Notes</label>
                        <textarea id="prodNotes" rows="2" placeholder="Product notes..."></textarea>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" style="flex: 1;">Save Product</button>
                    <button type="button" onclick="closeProductModal()" style="background: #6b7280; flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Batch Modal -->
    <div id="batchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="batchModalTitle">Add Inventory Batch</h2>
                <button class="close-modal" onclick="closeBatchModal()">‚úï Close</button>
            </div>
            <form id="batchForm">
                <div class="form-row">
                    <div>
                        <label>Number of Cases *</label>
                        <input type="number" id="batchCases" required min="1" placeholder="e.g., 5" oninput="calcBatchTotal()">
                    </div>
                    <div>
                        <label>Total Items</label>
                        <input type="number" id="batchTotal" readonly style="background: #f3f4f6;">
                        <div class="help-text" id="batchCalc">Auto-calculated</div>
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>Expiration Date</label>
                        <input type="date" id="batchExpiry">
                    </div>
                    <div>
                        <label>Location</label>
                        <input type="text" id="batchLocation" placeholder="e.g., Aisle 3">
                    </div>
                </div>
                <div class="form-row">
                    <div style="grid-column: 1 / -1;">
                        <label>Batch Notes</label>
                        <textarea id="batchNotes" rows="2" placeholder="Delivery notes..."></textarea>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" style="flex: 1;">Save Batch</button>
                    <button type="button" onclick="closeBatchModal()" style="background: #6b7280; flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Load JavaScript modules -->
    <script src="js/core.js"></script>
    <script src="js/products.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/scanner.js"></script>
</body>
</html>
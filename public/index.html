<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Inventory</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/v0.6.0-features.css">
    <link rel="stylesheet" href="css/filters.css">
    <link rel="stylesheet" href="css/categories.css">
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 20px;">
                <button class="menu-toggle" onclick="toggleMenu()" title="Menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <h1>üõçÔ∏è Grocery Inventory</h1>
            </div>
            <div class="header-right">
                <button id="darkModeToggle" class="icon-btn" title="Toggle theme">üåô</button>
                <div id="status" class="status">Connecting...</div>
                <div class="current-time" id="currentTime"></div>
            </div>
        </div>

        <div id="updateBanner" class="update-banner">
            üéâ New version available! <button onclick="window.open('https://github.com/zv20/invai', '_blank')" style="margin-left:10px;padding:5px 15px;">View Update</button>
        </div>

        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Menu</h3>
                <button class="close-sidebar" onclick="toggleMenu()">‚úï</button>
            </div>
            <nav class="nav-menu">
                <a href="#" class="nav-item active" onclick="switchTab('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="switchTab('inventory')">
                    <span class="nav-icon">üì¶</span>
                    <span class="nav-text">Inventory</span>
                </a>
                <a href="#" class="nav-item" onclick="switchTab('reports')">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Reports</span>
                </a>
                <a href="#" class="nav-item" onclick="switchTab('settings')">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span class="nav-text">Settings</span>
                </a>
            </nav>
        </div>

        <!-- Overlay for mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleMenu()"></div>

        <!-- Dashboard Tab -->
        <div id="dashboardTab" class="tab-content active">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="margin: 0;">üìä Dashboard</h2>
                <button class="refresh-button" onclick="refreshDashboard()">üîÑ Refresh</button>
            </div>

            <!-- Stats Cards -->
            <div class="dashboard-grid">
                <div class="stat-card stat-card-primary">
                    <div class="stat-icon">üì¶</div>
                    <div class="stat-label">Total Products</div>
                    <div class="stat-value" id="dash-total-products">0</div>
                </div>
                <div class="stat-card stat-card-success">
                    <div class="stat-icon">üìã</div>
                    <div class="stat-label">Total Items</div>
                    <div class="stat-value" id="dash-total-items">0</div>
                </div>
                <div class="stat-card stat-card-warning">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-label">Total Value</div>
                    <div class="stat-value" id="dash-total-value">$0.00</div>
                </div>
                <div class="stat-card stat-card-danger">
                    <div class="stat-icon">‚ö†Ô∏è</div>
                    <div class="stat-label">Low Stock Items</div>
                    <div class="stat-value" id="dash-low-stock">0</div>
                </div>
            </div>

            <!-- Activity Feed & Alerts Row -->
            <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 20px;">
                <div class="dashboard-section">
                    <h3>üìù Recent Activity</h3>
                    <div id="activityFeed" class="activity-feed">
                        <div class="empty-state-small">Loading...</div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>‚≠ê Favorites</h3>
                    <div id="favoritesWidget">
                        <div class="empty-state-small">No favorites yet</div>
                    </div>
                </div>
            </div>

            <!-- Expiration Alerts -->
            <div class="dashboard-section">
                <h3>üö® Expiration Alerts</h3>
                <div class="alerts-container">
                    <div class="alert-box alert-box-expired">
                        <div class="alert-header">
                            <div class="alert-title">‚ùå Expired</div>
                            <div class="alert-count" id="alert-expired-count">0</div>
                        </div>
                        <div class="alert-list" id="expiredList">
                            <div class="empty-state-small">‚úì All good!</div>
                        </div>
                    </div>
                    <div class="alert-box alert-box-urgent">
                        <div class="alert-header">
                            <div class="alert-title">‚ö†Ô∏è Urgent (7 days)</div>
                            <div class="alert-count" id="alert-urgent-count">0</div>
                        </div>
                        <div class="alert-list" id="urgentList">
                            <div class="empty-state-small">‚úì All good!</div>
                        </div>
                    </div>
                    <div class="alert-box alert-box-soon">
                        <div class="alert-header">
                            <div class="alert-title">‚è∞ Soon (30 days)</div>
                            <div class="alert-count" id="alert-soon-count">0</div>
                        </div>
                        <div class="alert-list" id="soonList">
                            <div class="empty-state-small">‚úì All good!</div>
                        </div>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div class="dashboard-section">
                    <h3>üìÅ Category Breakdown</h3>
                    <div class="category-breakdown" id="categoryBreakdown">
                        <div class="empty-state-small">No categories yet</div>
                    </div>
                </div>
                <div class="dashboard-section">
                    <h3>‚è±Ô∏è Recent Products</h3>
                    <div class="activity-list" id="recentActivity">
                        <div class="empty-state-small">No recent products</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Unified Inventory Tab -->
        <div id="inventoryTab" class="tab-content">
            <!-- Product List View -->
            <div id="inventoryListView">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <h2 style="margin: 0;">üì¶ Inventory</h2>
                    <button onclick="openAddProductModal()">‚ûï Add Product</button>
                </div>

                <div id="inventoryValueSummary" class="value-summary" style="display: none;">
                    <div class="value-card">
                        <div class="value-label">Total Products</div>
                        <div class="value-amount" id="totalProducts">0</div>
                    </div>
                    <div class="value-card">
                        <div class="value-label">Total Items</div>
                        <div class="value-amount" id="totalItems">0</div>
                    </div>
                    <div class="value-card value-highlight">
                        <div class="value-label">üí∞ Total Inventory Value</div>
                        <div class="value-amount" id="totalValue">$0.00</div>
                    </div>
                </div>

                <div class="search-bar-container">
                    <input type="text" id="productSearch" placeholder="üîç Search products...">
                    <button class="btn-scan" onclick="openScanner('search')">üì∑ Scan Barcode</button>
                </div>

                <!-- Filters Panel (v0.7.4) -->
                <div id="filtersPanel" class="filters-panel">
                    <div class="filters-header">
                        <h4>üéõÔ∏è Filters <span id="activeFilterCount" class="filter-count">0</span></h4>
                        <button class="clear-filters-btn" onclick="clearAllFilters()" style="display: none;">‚úï Clear All</button>
                    </div>
                    <div class="filters-grid">
                        <div class="filter-group">
                            <label>Category</label>
                            <select id="filterCategory" onchange="applyFilters()">
                                <option value="">All Categories</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Supplier</label>
                            <select id="filterSupplier" onchange="applyFilters()">
                                <option value="">All Suppliers</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Stock Status</label>
                            <select id="filterStock" onchange="applyFilters()">
                                <option value="">All Stock Levels</option>
                                <option value="in-stock">In Stock</option>
                                <option value="low-stock">Low Stock</option>
                                <option value="out-of-stock">Out of Stock</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Expiry Status</label>
                            <select id="filterExpiry" onchange="applyFilters()">
                                <option value="">All Expiry Status</option>
                                <option value="expired">Expired</option>
                                <option value="urgent">Urgent (7 days)</option>
                                <option value="soon">Soon (30 days)</option>
                                <option value="normal">Normal</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="productList" class="product-list">
                    <div class="empty-state">
                        <h3>No products yet</h3>
                        <p>Add your first product to get started</p>
                    </div>
                </div>
            </div>

            <!-- Product Detail View -->
            <div id="inventoryDetailView" style="display: none;">
                <div style="margin-bottom: 20px;">
                    <button onclick="backToInventoryList()" style="background: #6b7280;">‚Üê Back to Inventory</button>
                </div>

                <!-- Expiration Alert Banners -->
                <div id="detailAlertBanners"></div>

                <!-- Batch Suggestion (v0.6.0) -->
                <div id="batch-suggestion-container" class="batch-suggestion-container"></div>

                <!-- Product Info Card -->
                <div class="dashboard-section" style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 15px;">
                        <div>
                            <h2 style="margin: 0; margin-bottom: 10px;" id="detailProductName">Product Name</h2>
                            <div id="detailProductMeta" style="display: flex; gap: 10px; flex-wrap: wrap;"></div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="editProductFromDetail()">‚úèÔ∏è Edit Product</button>
                            <button onclick="deleteProductFromDetail()" class="btn-danger">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                    <div id="detailProductInfo" style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;"></div>
                </div>

                <!-- Inventory Batches -->
                <div class="dashboard-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0;">üìã Inventory Batches</h3>
                        <button onclick="openAddBatchModal()">‚ûï Add Batch</button>
                    </div>
                    <div id="detailBatchList" class="batch-list"></div>
                </div>
            </div>
        </div>

        <!-- Reports Tab (NEW v0.8.0) -->
        <div id="reportsTab" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="margin: 0;">üìä Reports & Analytics</h2>
                <button id="exportReportBtn">üíæ Export Report</button>
            </div>

            <div class="report-nav">
                <button class="report-nav-item active" data-report="overview">Overview</button>
                <button class="report-nav-item" data-report="stock-value">Stock Value</button>
                <button class="report-nav-item" data-report="expiration">Expiration</button>
                <button class="report-nav-item" data-report="low-stock">Low Stock</button>
                <button class="report-nav-item" data-report="turnover">Turnover</button>
            </div>

            <div id="reportContent" class="report-content">
                <div class="loading">Loading reports...</div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsTab" class="tab-content">
            <h2 style="margin-bottom: 20px;">Settings</h2>
            <div class="settings-nav">
                <button class="settings-nav-item active" onclick="switchSettingsTab('updates')">üîÑ Updates</button>
                <button class="settings-nav-item" onclick="switchSettingsTab('display')">üé® Display</button>
                <button class="settings-nav-item" onclick="switchSettingsTab('categories')">üè∑Ô∏è Categories</button>
                <button class="settings-nav-item" onclick="switchSettingsTab('suppliers')">üì¶ Suppliers</button>
                <button class="settings-nav-item" onclick="switchSettingsTab('backups')">üíæ Backups</button>
                <button class="settings-nav-item" onclick="switchSettingsTab('about')">‚ÑπÔ∏è About</button>
                <button class="settings-nav-item" onclick="switchSettingsTab('danger')">‚ö†Ô∏è Danger Zone</button>
            </div>

            <!-- Updates Tab -->
            <div id="settings-updates" class="settings-subtab active">
                <div class="settings-section">
                    <h3>Update Channel</h3>
                    <div id="channelSelector"></div>
                    <div id="currentStatus"></div>
                    <div class="btn-group">
                        <button id="checkUpdatesBtn" onclick="checkForUpdatesNow()">üîç Check for Updates</button>
                        <button id="switchChannelBtn" onclick="switchChannelAndUpdate()" disabled>üîÑ Switch Channel & Update</button>
                    </div>
                    <div id="updateResults" class="hidden"></div>
                </div>
                <div class="settings-section">
                    <h3>System Information</h3>
                    <p><strong>Running Version:</strong> <span id="settingsVersion">Checking...</span></p>
                    <p style="margin-top: 10px;"><strong>Latest Version:</strong> <span id="latestVersion">Checking...</span></p>
                    <p style="margin-top: 10px;"><strong>Database:</strong> SQLite</p>
                    <p style="margin-top: 10px;"><strong>Last Check:</strong> <span id="lastCheck">Never</span></p>
                </div>
            </div>

            <!-- Display Tab (NEW v0.8.0) -->
            <div id="settings-display" class="settings-subtab">
                <div class="settings-section">
                    <h3>üé® Appearance</h3>
                    <div class="form-group">
                        <label>Theme</label>
                        <select id="themeSelector" onchange="changeTheme(this.value)">
                            <option value="auto">Auto (System)</option>
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                        <div class="help-text">Choose your preferred color scheme</div>
                    </div>
                </div>
            </div>

            <!-- Other settings tabs remain -->

        </div>
    </div>

    <div id="versionFooter" class="version-footer" onclick="checkVersion()" title="Click to check for updates">
        <span id="footerVersionText">v0.8.0</span>
    </div>

    <!-- Command Palette (NEW v0.8.0) -->
    <div id="commandPalette" class="command-palette">
        <div class="command-palette-content">
            <input type="text" id="commandInput" placeholder="Type a command..." autocomplete="off">
            <div id="commandResults" class="command-results"></div>
        </div>
    </div>

    <!-- Load JavaScript modules in CORRECT ORDER -->
    <!-- CRITICAL: v0.8.0 modules MUST load BEFORE core.js -->
    <script src="js/utils.js"></script>
    
    <!-- v0.8.0 modules - Load these FIRST -->
    <script src="js/dark-mode.js"></script>
    <script src="js/activity-log.js"></script>
    <script src="js/favorites.js"></script>
    <script src="js/keyboard-shortcuts.js"></script>
    <script src="js/command-palette.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/charts.js"></script>
    
    <!-- Core initialization - AFTER v0.8.0 modules -->
    <script src="js/core.js"></script>
    
    <!-- Feature modules -->
    <script src="js/dashboard.js"></script>
    <script src="js/inventory.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/scanner.js"></script>
    <script src="js/batch-suggestions.js"></script>
    <script src="js/quick-actions.js"></script>
    <script src="js/update-settings.js"></script>
    <script src="js/filters.js"></script>
    <script src="js/categories-manager.js"></script>
    <script src="js/suppliers-manager.js"></script>
</body>
</html>
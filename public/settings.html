<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Settings - Grocery Inventory</title>
    
    <!-- Core CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/categories.css">
    <link rel="stylesheet" href="css/inline-overrides.css">
    <link rel="stylesheet" href="/css/mobile.css">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    
    <!-- Authentication -->
    <script src="/js/auth.js"></script>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <div class="header">
            <div class="header-left-group">
                <button class="menu-toggle" title="Menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <h1>ğŸ›ï¸ Grocery Inventory</h1>
            </div>
            <div class="header-right">
                <button id="darkModeToggle" class="icon-btn" title="Toggle theme">ğŸŒ™</button>
                <div id="status" class="status">Connecting...</div>
                <div class="current-time" id="currentTime"></div>
                <button data-action="logout" class="icon-btn logout-btn" title="Logout">ğŸšª</button>
            </div>
        </div>

        <div id="updateBanner" class="update-banner">
            ğŸ‰ New version available! <button data-action="viewGitHubUpdate" class="update-banner-btn">View Update</button>
        </div>

        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Menu</h3>
                <button class="close-sidebar">âœ•</button>
            </div>
            <nav class="nav-menu">
                <a href="/dashboard.html" class="nav-item" data-page="dashboard">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="/inventory.html" class="nav-item" data-page="inventory">
                    <span class="nav-icon">ğŸ“¦</span>
                    <span class="nav-text">Inventory</span>
                </a>
                <a href="/reports.html" class="nav-item" data-page="reports">
                    <span class="nav-icon">ğŸ“ˆ</span>
                    <span class="nav-text">Reports</span>
                </a>
                <a href="/users.html" class="nav-item" data-page="users">
                    <span class="nav-icon">ğŸ‘¥</span>
                    <span class="nav-text">Users</span>
                </a>
                <a href="/predictions.html" class="nav-item" data-page="predictions">
                    <span class="nav-icon">ğŸ”®</span>
                    <span class="nav-text">Predictions</span>
                </a>
                <a href="/advanced-search.html" class="nav-item" data-page="search">
                    <span class="nav-icon">ğŸ”</span>
                    <span class="nav-text">Advanced Search</span>
                </a>
                <a href="/dashboard-builder.html" class="nav-item" data-page="builder">
                    <span class="nav-icon">ğŸ¨</span>
                    <span class="nav-text">Dashboard Builder</span>
                </a>
                <a href="/settings.html" class="nav-item active" data-page="settings">
                    <span class="nav-icon">âš™ï¸</span>
                    <span class="nav-text">Settings</span>
                </a>
            </nav>
        </div>

        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <!-- Settings Content -->
        <h2 class="settings-header">âš™ï¸ Settings</h2>
        <div class="settings-nav">
            <button class="settings-nav-item active" data-settings-tab="updates">ğŸ”„ Updates</button>
            <button class="settings-nav-item" data-settings-tab="categories">ğŸ·ï¸ Categories</button>
            <button class="settings-nav-item" data-settings-tab="suppliers">ğŸ“¦ Suppliers</button>
            <button class="settings-nav-item" data-settings-tab="backups">ğŸ’¾ Backups</button>
            <button class="settings-nav-item" data-settings-tab="about">â„¹ï¸ About</button>
            <button class="settings-nav-item" data-settings-tab="danger">âš ï¸ Danger Zone</button>
        </div>

        <!-- Updates Tab -->
        <div id="settings-updates" class="settings-subtab active">
            <div class="settings-section">
                <h3>ğŸ”„ Update Channel</h3>
                <div id="channelSelector"></div>
                <div id="currentStatus"></div>
                <div class="btn-group">
                    <button id="checkUpdatesBtn" data-action="checkForUpdatesNow">ğŸ” Check for Updates</button>
                    <button id="switchChannelBtn" data-action="switchChannelAndUpdate" disabled>ğŸ”„ Switch Channel & Update</button>
                </div>
                <div id="versionStatus"></div>
            </div>
            <div class="settings-section">
                <h3>â„¹ï¸ System Information</h3>
                <p><strong>Running Version:</strong> <span id="settingsVersion">Checking...</span></p>
                <p class="mt-10"><strong>Latest Version:</strong> <span id="latestVersion">Checking...</span></p>
                <p class="mt-10"><strong>Database:</strong> SQLite</p>
                <p class="mt-10"><strong>Last Check:</strong> <span id="lastCheck">Never</span></p>
            </div>
        </div>

        <!-- Categories Tab -->
        <div id="settings-categories" class="settings-subtab">
            <div class="settings-section">
                <h3>ğŸ·ï¸ Categories Management</h3>
                <p class="mb-15">Organize your products into categories for better filtering and reporting.</p>
                <button data-action="openAddCategoryModal">â• Add Category</button>
                <div id="categoriesList" class="categories-list">
                    <div class="loading">Loading categories...</div>
                </div>
            </div>
        </div>

        <!-- Suppliers Tab -->
        <div id="settings-suppliers" class="settings-subtab">
            <div class="settings-section">
                <h3>ğŸ“¦ Suppliers Management</h3>
                <p class="mb-15">Manage your supplier contacts and track products by supplier.</p>
                <button data-action="openAddSupplierModal">â• Add Supplier</button>
                <div id="suppliersList" class="suppliers-list">
                    <div class="loading">Loading suppliers...</div>
                </div>
            </div>
        </div>

        <!-- Backups Tab -->
        <div id="settings-backups" class="settings-subtab">
            <div class="settings-section">
                <h3>ğŸ’¾ Database Backups</h3>
                <p class="mb-15">Create and manage database backups. System automatically keeps the last 10 backups.</p>
                <div class="btn-group">
                    <button data-action="createBackup">ğŸ’¾ Create Backup Now</button>
                    <button class="btn-import" data-action="triggerUploadRestore">ğŸ“¤ Upload & Restore</button>
                </div>
                <input type="file" id="backupUploadInput" accept=".db" class="file-input-hidden">
                <div class="help-text mt-10">Create new backups or upload an existing backup file to restore</div>
                <h4 class="mt-25 mb-15">Backup History</h4>
                <div id="backupList" class="backup-list">
                    <div class="backup-list-loading">ğŸ“‚ Loading backups...</div>
                </div>
            </div>
            <div class="settings-section">
                <h3>ğŸ“ˆ Data Management</h3>
                <div class="btn-group">
                    <button class="btn-export" data-action="exportCSV">ğŸ’¾ Export to CSV</button>
                    <button class="btn-import" data-action="triggerImport">ğŸ“‚ Import from CSV</button>
                </div>
                <input type="file" id="csvFileInput" accept=".csv" class="file-input-hidden">
                <div class="help-text mt-10">Export your inventory data or import from a backup CSV file</div>
            </div>
        </div>

        <!-- About Tab -->
        <div id="settings-about" class="settings-subtab">
            <div class="settings-section">
                <h3>ğŸ›ï¸ Grocery Inventory v0.11.0</h3>
                <p class="about-intro">Professional inventory management for grocery stores</p>
                <h4 class="about-section-title">Latest Changes</h4>
                <ul class="changelog-list">
                    <li>âœ… <strong>v0.11.0</strong> - Split pages & unified navigation (mobile/desktop)</li>
                    <li>âœ… <strong>v0.10.7</strong> - Update system testing & version bumps</li>
                    <li>âœ… <strong>v0.8.7</strong> - 100% CSP Compliance (zero inline styles or handlers)</li>
                    <li>ğŸ” <strong>v0.8.1</strong> - Authentication & Authorization, User Management</li>
                    <li>ğŸ¨ <strong>v0.8.0</strong> - Dark Mode, Keyboard Shortcuts, Command Palette</li>
                </ul>
                <h4 class="about-section-title">Links</h4>
                <p><a href="https://github.com/zv20/invai" target="_blank" class="about-link">ğŸ”— GitHub Repository</a></p>
                <p class="mt-10"><a href="https://github.com/zv20/invai/blob/beta/CHANGELOG.md" target="_blank" class="about-link">ğŸ“‹ Full Changelog</a></p>
            </div>
        </div>

        <!-- Danger Zone Tab -->
        <div id="settings-danger" class="settings-subtab">
            <div class="settings-section">
                <h3>âš ï¸ Danger Zone</h3>
                <p class="danger-warning"><strong>Warning:</strong> Actions in this section are permanent and cannot be undone. Please create a backup before proceeding.</p>
                <button class="btn-danger" data-action="confirmReset">ğŸ—‘ï¸ Reset All Data</button>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="categoryModalTitle">Add Category</h2>
                <button class="close-modal" data-action="closeCategoryModal">âœ• Close</button>
            </div>
            <form id="categoryForm">
                <div class="form-row">
                    <div>
                        <label>Category Name *</label>
                        <input type="text" id="categoryName" required placeholder="e.g., Beverages">
                    </div>
                    <div>
                        <label>Color</label>
                        <input type="color" id="categoryColor" value="#667eea">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field-full">
                        <label>Description</label>
                        <textarea id="categoryDescription" rows="2" placeholder="Category description..."></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit">Save Category</button>
                    <button type="button" data-action="closeCategoryModal" class="cancel-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supplier Modal -->
    <div id="supplierModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="supplierModalTitle">Add Supplier</h2>
                <button class="close-modal" data-action="closeSupplierModal">âœ• Close</button>
            </div>
            <form id="supplierForm">
                <div class="form-row">
                    <div class="form-field-full">
                        <label>Supplier Name *</label>
                        <input type="text" id="supplierName" required placeholder="e.g., Sysco Foods">
                    </div>
                </div>
                <div class="form-row">
                    <div>
                        <label>Contact Name</label>
                        <input type="text" id="supplierContactName" placeholder="e.g., John Smith">
                    </div>
                    <div>
                        <label>Contact Phone</label>
                        <input type="tel" id="supplierContactPhone" placeholder="e.g., (555) 123-4567">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field-full">
                        <label>Contact Email</label>
                        <input type="email" id="supplierContactEmail" placeholder="e.g., sales@sysco.com">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field-full">
                        <label>Address</label>
                        <textarea id="supplierAddress" rows="2" placeholder="Supplier address..."></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field-full">
                        <label>Notes</label>
                        <textarea id="supplierNotes" rows="2" placeholder="Supplier notes..."></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field-full">
                        <label class="supplier-active-label">
                            <input type="checkbox" id="supplierIsActive" checked class="supplier-active-checkbox">
                            <span>Active (uncheck to mark as inactive)</span>
                        </label>
                        <div class="help-text">Inactive suppliers won't appear in product dropdowns</div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit">Save Supplier</button>
                    <button type="button" data-action="closeSupplierModal" class="cancel-btn">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Command Palette -->
    <div id="commandPalette" class="command-palette">
        <div class="command-palette-content">
            <input type="text" id="commandInput" placeholder="Type a command..." autocomplete="off">
            <div id="commandResults" class="command-results"></div>
        </div>
    </div>

    <div id="versionFooter" class="version-footer" title="Click to check for updates">
        <span id="footerVersionText">v0.11.0</span>
    </div>

    <!-- JavaScript -->
    <script src="js/utils.js"></script>
    <script src="js/event-handlers.js"></script>
    <script src="js/shared-nav.js"></script>
    <script src="js/dark-mode.js"></script>
    <script src="js/keyboard-shortcuts.js"></script>
    <script src="js/command-palette.js"></script>
    <script src="js/core.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/update-settings.js"></script>
    <script src="js/categories-manager.js"></script>
    <script src="js/suppliers-manager.js"></script>
    <script src="/lib/pwa/offlineStorage.js"></script>
    <script src="/js/pwa-init.js"></script>
</body>
</html>
